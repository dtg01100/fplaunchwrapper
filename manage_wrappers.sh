#!/bin/bash

CONFIG_DIR="$HOME/.config/flatpak-wrappers"
BIN_DIR_FILE="$CONFIG_DIR/bin_dir"
BIN_DIR="$HOME/bin"  # default
if [ -f "$BIN_DIR_FILE" ]; then
    BIN_DIR=$(cat "$BIN_DIR_FILE")
fi
BLOCKLIST="$CONFIG_DIR/blocklist"

mkdir -p "$CONFIG_DIR"

usage() {
    echo "Usage: $0 <command> [args]"
    echo "Commands:"
    echo "  help                 - Show this help"
    echo "  list                 - List current wrappers"
    echo "  remove <name>        - Remove a specific wrapper"
    echo "  remove-pref <name>   - Remove preference for a wrapper"
    echo "  set-pref <name> <system|flatpak> - Set preference for a wrapper"
    echo "  set-alias <name> <alias> - Set an alias for a wrapper"
set-env <name> <var> <value> - Set environment variable for a wrapper
  remove-env <name> <var> - Remove environment variable for a wrapper
  list-env <name>      - List environment variables for a wrapper
    echo "  remove-alias <alias> - Remove an alias"
    echo "  export-prefs <file>  - Export preferences and blocklist to file"
    echo "  import-prefs <file>  - Import preferences and blocklist from file"
    echo "  block <id>           - Block a Flatpak ID from getting a wrapper"
    echo "  unblock <id>         - Unblock a Flatpak ID"
    echo "  list-blocked         - List blocked IDs"
set-pref-all <system|flatpak> - Set preference for all wrappers
    echo "  regenerate           - Regenerate all wrappers"
    exit 1
}

list_wrappers() {
    echo "Current wrappers in $BIN_DIR:"
    for script in "$BIN_DIR"/*; do
        if [ -f "$script" ] && [ -x "$script" ]; then
            name=$(basename "$script")
            id=$(grep "flatpak run" "$script" | head -1 | awk '{print $4}' | tr -d '"' || echo "unknown")
            echo "  $name -> $id"
        fi
    done
}

remove_wrapper() {
    name="$1"
    script_path="$BIN_DIR/$name"
    if [ -f "$script_path" ]; then
        read -r -p "Are you sure you want to remove wrapper '$name'? (y/n): " confirm
        if [[ $confirm =~ ^[Yy]$ ]]; then
            rm "$script_path"
            pref_file="$CONFIG_DIR/$name.pref"
            [ -f "$pref_file" ] && rm "$pref_file"
            # Remove aliases pointing to this wrapper
            sed -i "/^$name /d" "$CONFIG_DIR/aliases" 2>/dev/null
            for alias in "$BIN_DIR"/*; do
                if [ -L "$alias" ] && [ "$(readlink "$alias" 2>/dev/null)" = "$script_path" ]; then
                    rm "$alias"
                fi
            done
            echo "Removed wrapper, preference, and aliases for $name"
        else
    echo "in else"
    echo "command=$command"
            echo "Removal cancelled."
        fi
    else
    echo "in else"
    echo "command=$command"
        echo "Wrapper $name not found"
    fi
}

remove_pref() {
    name="$1"
    pref_file="$CONFIG_DIR/$name.pref"
    if [ -f "$pref_file" ]; then
        read -r -p "Are you sure you want to remove preference for '$name'? (y/n): " confirm
        if [[ $confirm =~ ^[Yy]$ ]]; then
            rm "$pref_file"
            echo "Removed preference for $name"
        else
    echo "in else"
    echo "command=$command"
            echo "Removal cancelled."
        fi
    else
    echo "in else"
    echo "command=$command"
        echo "No preference found for $name"
    fi
}

set_pref() {
    name="$1"
    choice="$2"
    if [ "$choice" != "system" ] && [ "$choice" != "flatpak" ]; then
        echo "Invalid choice: use 'system' or 'flatpak'"
        return
    fi
    pref_file="$CONFIG_DIR/$name.pref"
    echo "$choice" > "$pref_file"
    echo "Set preference for $name to $choice"
}

set_alias() {
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    alias="$2"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    script_path="$BIN_DIR/$name"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    alias_path="$BIN_DIR/$alias"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ ! -f "$script_path" ]; then
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Wrapper $name not found"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        return
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -e "$alias_path" ]; then
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Alias $alias already exists"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        return
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    read -r -p "Create alias '$alias' for '$name'? (y/n): " confirm
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [[ $confirm =~ ^[Yy]$ ]]; then
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        ln -s "$script_path" "$alias_path"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "$name $alias" >> "$CONFIG_DIR/aliases"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Set alias $alias for $name"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    echo "in else"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    echo "command=$command"
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Alias creation cancelled."
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_env() {
    name="$1"
    var="$2"
    value="$3"
    env_file="$CONFIG_DIR/$name.env"
    if [ ! -f "$BIN_DIR/$name" ]; then
        echo "Wrapper $name not found"
        return
    fi
    read -r -p "Set $var=$value for '$name'? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        echo "export $var=\"$value\"" >> "$env_file"
        echo "Set $var for $name"
    else
        echo "Cancelled."
    fi
}

remove_env() {
    name="$1"
    var="$2"
    env_file="$CONFIG_DIR/$name.env"
    if [ -f "$env_file" ]; then
        sed -i "/export $var=/d" "$env_file"
        echo "Removed $var for $name"
    else
        echo "No env file for $name"
    fi
}

list_env() {
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    name="$1"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    env_file="$CONFIG_DIR/$name.env"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    if [ -f "$env_file" ]; then
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "Environment variables for $name:"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        cat "$env_file"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    else
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
        echo "No environment variables set for $name"
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
    fi
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}
}
set_pref_all() {
    pref="$1"
    if [ "$pref" != "system" ] && [ "$pref" != "flatpak" ]; then
        echo "Invalid preference: use system or flatpak"
        return
    fi
    read -r -p "Set preference to  for all wrappers? (y/n): " confirm
    if [[ $confirm =~ ^[Yy]$ ]]; then
        for script in "$BIN_DIR"/*; do
            if [ -f "$script" ] && grep -q "Generated by fplaunchwrapper" "$script" 2>/dev/null; then
                name=$(basename "$script")
                echo "$pref" > "$CONFIG_DIR/$name.pref"
            fi
        done
        echo "Set preference to $pref for all wrappers"
    else
        echo "Cancelled."
    fi
}

remove_alias() {
    alias="$1"
    alias_path="$BIN_DIR/$alias"
    if [ -L "$alias_path" ]; then
        read -r -p "Remove alias '$alias'? (y/n): " confirm
        if [[ $confirm =~ ^[Yy]$ ]]; then
            rm "$alias_path"
            sed -i "/ $alias$/d" "$CONFIG_DIR/aliases" 2>/dev/null
            echo "Removed alias $alias"
        else
    echo "in else"
    echo "command=$command"
            echo "Removal cancelled."
        fi
    else
    echo "in else"
    echo "command=$command"
        echo "Alias $alias not found"
    fi
}

export_prefs() {
    file="$1"
    tar -czf "$file" -C "$CONFIG_DIR" . 2>/dev/null
    echo "Exported preferences to $file"
}

import_prefs() {
    file="$1"
    if [ -f "$file" ]; then
        tar -xzf "$file" -C "$CONFIG_DIR" 2>/dev/null
        echo "Imported preferences from $file"
    else
    echo "in else"
    echo "command=$command"
        echo "File $file not found"
    fi
}

block_id() {
    id="$1"
    if ! grep -q "^$id$" "$BLOCKLIST" 2>/dev/null; then
        read -r -p "Block Flatpak ID '$id'? Wrappers won't be created for it. (y/n): " confirm
        if [[ $confirm =~ ^[Yy]$ ]]; then
            echo "$id" >> "$BLOCKLIST"
            echo "Blocked $id"
        else
    echo "in else"
    echo "command=$command"
            echo "Blocking cancelled."
        fi
    else
    echo "in else"
    echo "command=$command"
        echo "$id already blocked"
    fi
}

unblock_id() {
    id="$1"
    if grep -q "^$id$" "$BLOCKLIST" 2>/dev/null; then
        read -r -p "Unblock Flatpak ID '$id'? (y/n): " confirm
        if [[ $confirm =~ ^[Yy]$ ]]; then
            sed -i "/^$id$/d" "$BLOCKLIST"
            echo "Unblocked $id"
        else
    echo "in else"
    echo "command=$command"
            echo "Unblocking cancelled."
        fi
    else
    echo "in else"
    echo "command=$command"
        echo "$id not blocked"
    fi
}

list_blocked() {
    echo "Blocked Flatpak IDs:"
    if [ -f "$BLOCKLIST" ]; then
        cat "$BLOCKLIST"
    else
    echo "in else"
    echo "command=$command"
        echo "None"
    fi
}

regenerate() {
    script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    wrapper_script="$script_dir/generate_flatpak_wrappers.sh"
    if [ -f "$wrapper_script" ]; then
        bash "$wrapper_script" "$BIN_DIR"
    else
    echo "in else"
    echo "command=$command"
        echo "Wrapper script not found"
    fi
}

select_wrapper() {
    echo "Available wrappers:"
    wrappers=()
    i=1
    for script in "$BIN_DIR"/*; do
        if [ -f "$script" ] && [ -x "$script" ]; then
            name=$(basename "$script")
            id=$(grep "flatpak run" "$script" | head -1 | awk '{print $4}' | tr -d '"' || echo "unknown")
            echo "$i. $name -> $id"
            wrappers[$i]="$name"
            ((i++))
        fi
    done
    if [ ${#wrappers[@]} -eq 0 ]; then
        echo "No wrappers found"
        return 1
    fi
    read -r -p "Choose a wrapper (1-$((i-1))): " choice
    if [[ $choice =~ ^[0-9]+$ ]] && [ "$choice" -ge 1 ] && [ "$choice" -lt "$i" ]; then
        selected="${wrappers[$choice]}"
        echo "Selected: $selected"
        return 0
    else
    echo "in else"
    echo "command=$command"
        echo "Invalid choice"
        return 1
    fi
}

if [ $# -eq 0 ]; then
    # Interactive menu
    if command -v dialog >/dev/null 2>&1; then
        # Use dialog for GUI-like menu
        while true; do
            option=$(dialog --clear --title "Flatpak Wrappers Management" \
                --menu "Choose an option:" 20 60 14 \
                1 "Help" \
                2 "List wrappers" \
                3 "Remove wrapper" \
                4 "Remove preference" \
                5 "Set preference" \
                6 "Set alias" \
                7 "Remove alias" \
                8 "Export preferences" \
                9 "Import preferences" \
                10 "Block ID" \
                11 "Unblock ID" \
                12 "List blocked IDs" \
                13 "Regenerate wrappers" \
                14 "Exit" \
                2>&1 >/dev/tty)
            clear
            case $option in
                1)
                    usage
                    ;;
                2)
                    list_wrappers
                    ;;
                3)
                    if select_wrapper; then
                        remove_wrapper "$selected"
                    fi
                    ;;
                4)
                    if select_wrapper; then
                        remove_pref "$selected"
                    fi
                    ;;
                5)
                    if select_wrapper; then
                        pref=$(dialog --inputbox "Enter preference (system/flatpak):" 10 40 2>&1 >/dev/tty)
                        clear
                        set_pref "$selected" "$pref"
                    fi
                    ;;
                6)
                    if select_wrapper; then
                        alias=$(dialog --inputbox "Enter alias name:" 10 40 2>&1 >/dev/tty)
                        clear
                        set_alias "$selected" "$alias"
                    fi
                    ;;
                7)
                    alias=$(dialog --inputbox "Enter alias to remove:" 10 40 2>&1 >/dev/tty)
                    clear
                    remove_alias "$alias"
                    ;;
                8)
                    file=$(dialog --inputbox "Enter export file path:" 10 40 2>&1 >/dev/tty)
                    clear
                    export_prefs "$file"
                    ;;
                9)
                    file=$(dialog --inputbox "Enter import file path:" 10 40 2>&1 >/dev/tty)
                    clear
                    import_prefs "$file"
                    ;;
                10)
                    id=$(dialog --inputbox "Enter Flatpak ID to block:" 10 40 2>&1 >/dev/tty)
                    clear
                    block_id "$id"
                    ;;
                11)
                    id=$(dialog --inputbox "Enter Flatpak ID to unblock:" 10 40 2>&1 >/dev/tty)
                    clear
                    unblock_id "$id"
                    ;;
                12)
                    list_blocked
                    ;;
                13)
                    regenerate
                    ;;
                14|"")
                    exit 0
                    ;;
                *)
                    echo "Invalid option"
                    ;;
            esac
            echo "Press Enter to continue..."
            read -r
        done
    else
    echo "in else"
    echo "command=$command"
        # Fallback to text-based menu
        while true; do
            echo
        echo "Flatpak Wrappers Management Menu"
        echo "1. Help"
        echo "2. List wrappers"
        echo "3. Remove wrapper"
        echo "4. Remove preference"
        echo "5. Set preference"
        echo "6. Set alias"
        echo "7. Remove alias"
        echo "8. Export preferences"
        echo "9. Import preferences"
        echo "10. Block ID"
        echo "11. Unblock ID"
        echo "12. List blocked IDs"
        echo "13. Regenerate wrappers"
        echo "14. Exit"
            read -r -p "Choose an option (1-13): " option
            case $option in
                1)
                    list_wrappers
                    ;;
                2)
                    if select_wrapper; then
                        remove_wrapper "$selected"
                    fi
                    ;;
                3)
                    if select_wrapper; then
                        remove_pref "$selected"
                    fi
                    ;;
                4)
                    if select_wrapper; then
                        read -r -p "Enter preference (system/flatpak): " pref
                        set_pref "$selected" "$pref"
                    fi
                    ;;
                5)
                    if select_wrapper; then
                        read -r -p "Enter alias name: " alias
                        set_alias "$selected" "$alias"
                    fi
                    ;;
                6)
                    read -r -p "Enter alias to remove: " alias
                    remove_alias "$alias"
                    ;;
                7)
                    read -r -p "Enter export file path: " file
                    export_prefs "$file"
                    ;;
                8)
                    read -r -p "Enter import file path: " file
                    import_prefs "$file"
                    ;;
                9)
                    read -r -p "Enter Flatpak ID to block: " id
                    block_id "$id"
                    ;;
                10)
                    read -r -p "Enter Flatpak ID to unblock: " id
                    unblock_id "$id"
                    ;;
                11)
                    list_blocked
                    ;;
                12)
                    regenerate
                    ;;
                13)
                    exit 0
                    ;;
                *)
                    echo "Invalid option"
                    ;;
            esac
        done
    fi
else
    echo "in else"
    echo "command=$command"
    echo "$1=$1"
    command="$1"
    shift

    case $command in
        help)
            usage
            ;;
        list)
            list_wrappers
            ;;
        remove)
            if [ $# -ne 1 ]; then usage; fi
            remove_wrapper "$1"
            ;;
        remove-pref)
            if [ $# -ne 1 ]; then usage; fi
            remove_pref "$1"
            ;;
        set-pref)
            if [ $# -ne 2 ]; then usage; fi
            set_pref "$1" "$2"
            ;;
        block)
            if [ $# -ne 1 ]; then usage; fi
            block_id "$1"
            ;;
        unblock)
            if [ $# -ne 1 ]; then usage; fi
            unblock_id "$1"
            ;;
        list-blocked)
set-pref-all)
            if [ $# -ne 1 ]; then usage; fi
            set_pref_all "$1"
            ;;
set-pref-all <system|flatpak> - Set preference for all wrappers
            list_blocked
            ;;
        regenerate)
            regenerate
            ;;
        *)
            echo "unknown command: $command"
            usage
            ;;
    esac
fi