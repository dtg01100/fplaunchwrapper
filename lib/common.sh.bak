ensure_config_dir() {
    CONFIG_DIR="${CONFIG_DIR:-${XDG_CONFIG_HOME:-$HOME/.config}/flatpak-wrappers}"
    # Create parent directories if they don't exist, with better error handling
    local parent_dir
    parent_dir="$(dirname "$CONFIG_DIR")"
    
    # Try to create parent directory first
    if [ ! -d "$parent_dir" ]; then
        if ! mkdir -p "$parent_dir" 2>/dev/null; then
            echo "Error: Cannot create config directory parent: $parent_dir" >&2
            echo "Please check permissions and disk space." >&2
            return 1
        fi
    fi
    
    # Try to create config directory
    if ! mkdir -p "$CONFIG_DIR" 2>/dev/null; then
        echo "Error: Cannot create config directory: $CONFIG_DIR" >&2
        echo "Please check permissions and disk space." >&2
        return 1
    fi
    
    return 0
}
